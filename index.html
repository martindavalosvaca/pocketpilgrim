<!-- SINGLE-FILE REFACTOR -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PocketPilgrim - Find Peace Through Scripture</title>

  <style>
    /* =========================
       RESET / NORMALIZE
       ========================= */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* =========================
       TOKENS
       ========================= */
    :root {
      /* Colors */
      --color-primary: #3B82F6;
      --color-primary-dark: #1D4ED8;
      --color-primary-darker: #1E40AF;
      --color-secondary: #10B981;
      --color-secondary-dark: #059669;
      --color-secondary-darker: #047857;
      --color-white: #FFFFFF;
      --color-white-90: rgba(255, 255, 255, 0.9);
      --color-white-80: rgba(255, 255, 255, 0.8);
      --color-white-70: rgba(255, 255, 255, 0.7);
      --color-white-50: rgba(255, 255, 255, 0.5);
      --color-white-30: rgba(255, 255, 255, 0.3);
      --color-white-20: rgba(255, 255, 255, 0.2);
      --color-white-15: rgba(255, 255, 255, 0.15);
      --color-white-10: rgba(255, 255, 255, 0.1);
      --color-white-05: rgba(255, 255, 255, 0.05);
      --color-black-80: rgba(0, 0, 0, 0.8);
      --color-black-10: rgba(0, 0, 0, 0.1);
      --color-blue-light: #E0F2FE;
      --color-blue-lighter: #BAE6FD;
      --color-blue-alpha: rgba(147, 197, 253, 0.1);
      --color-blue-alpha-30: rgba(147, 197, 253, 0.3);
      --color-blue-alpha-40: rgba(147, 197, 253, 0.4);
      --color-blue-alpha-50: rgba(147, 197, 253, 0.5);
      --color-blue-alpha-60: rgba(147, 197, 253, 0.6);
      --color-primary-alpha-10: rgba(59, 130, 246, 0.1);
      --color-primary-alpha-15: rgba(59, 130, 246, 0.15);
      --color-primary-alpha-20: rgba(59, 130, 246, 0.2);
      --color-primary-alpha-25: rgba(59, 130, 246, 0.25);
      --color-primary-alpha-30: rgba(59, 130, 246, 0.3);

      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;

      /* Typography */
      --font-sans: system-ui, -apple-system, sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.85rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 2rem;
      --font-size-4xl: 2.5rem;
      --font-weight-normal: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 600;
      --font-weight-bold: 700;
      --line-height-tight: 1.1;
      --line-height-normal: 1.4;
      --line-height-relaxed: 1.5;

      /* Borders & Radius */
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 18px;
      --radius-xl: 20px;
      --radius-full: 50%;

      /* Effects */
      --transition-fast: 0.12s cubic-bezier(0.2, 0.8, 0.2, 1);
      --transition-normal: 0.3s ease;
      --transition-slow: 0.5s ease;
      --transition-page: 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      --blur-sm: blur(10px);
      --blur-md: blur(20px);
      --shadow-sm: 0 4px 15px rgba(59, 130, 246, 0.3);
      --shadow-md: 0 4px 20px rgba(59, 130, 246, 0.1);
      --shadow-lg: 0 10px 40px rgba(59, 130, 246, 0.3);
      --shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.5);

      /* Layout */
      --header-height: 80px;
      --container-max: 1200px;
      --chat-max: 800px;
      --z-header: 100;
      --z-modal: 1000;
    }

    /* =========================
       BASE / TYPOGRAPHY
       ========================= */
    body {
      font-family: var(--font-sans);
      min-height: 100vh;
      background: linear-gradient(135deg, var(--color-primary) 0%, #1E40AF 50%, #1E3A8A 100%);
      background-attachment: fixed;
      color: var(--color-white);
      overflow-x: hidden;
    }

    /* =========================
       LAYOUT
       ========================= */
    .gradient-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.9) 0%, 
        rgba(30, 64, 175, 0.95) 25%,
        rgba(30, 58, 138, 0.9) 50%,
        rgba(15, 23, 42, 0.8) 75%,
        rgba(2, 6, 23, 0.85) 100%
      );
      z-index: -1;
    }

    .floating-elements {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
    }

    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--z-header);
      padding: var(--space-md) var(--space-xl);
      backdrop-filter: var(--blur-md);
      background: var(--color-white-10);
      border-bottom: 1px solid var(--color-white-10);
      transition: all var(--transition-slow);
    }

    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: var(--container-max);
      margin: 0 auto;
    }

    .nav-links {
      display: flex;
      gap: var(--space-xl);
      align-items: center;
      transition: all var(--transition-slow);
    }

    .landing-page {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: var(--space-xl);
      padding-top: 120px;
      padding-bottom: 120px;
      text-align: center;
      transition: all var(--transition-page);
    }

    .landing-page.hidden {
      opacity: 0;
      transform: translateY(-50px);
      pointer-events: none;
    }

    .hero-content {
      max-width: var(--chat-max);
      margin: 0 auto;
    }

    .chat-interface {
      display: none;
      flex-direction: column;
      height: 100vh;
      padding-top: var(--header-height);
      opacity: 0;
      transition: all var(--transition-page);
    }

    .chat-interface.active {
      display: flex;
      opacity: 1;
    }

    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: var(--chat-max);
      margin: 0 auto;
      width: 100%;
      padding: var(--space-xl);
      min-height: 0;
    }

    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: var(--space-md) var(--space-xl);
      text-align: center;
      background: var(--color-black-10);
      backdrop-filter: var(--blur-md);
      border-top: 1px solid var(--color-white-10);
      transition: all var(--transition-slow);
      z-index: 50;
    }

    .footer.hidden {
      transform: translateY(100%);
      opacity: 0;
    }

    /* =========================
       COMPONENTS
       ========================= */

    /* Logo */
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: var(--font-weight-semibold);
      font-size: var(--font-size-xl);
      color: var(--color-white);
      text-decoration: none;
      cursor: pointer;
    }

    .logo-icon {
      width: 24px;
      height: 24px;
      color: var(--color-white-90);
    }

    /* Navigation */
    .nav-link {
      color: var(--color-white-80);
      text-decoration: none;
      font-weight: var(--font-weight-medium);
      transition: all var(--transition-fast);
    }

    .nav-link:hover {
      color: var(--color-white);
    }

    .nav-button {
      background: var(--color-white-20);
      border: 1px solid var(--color-white-30);
      color: var(--color-white);
      padding: 0.75rem var(--space-lg);
      border-radius: var(--radius-sm);
      font-weight: var(--font-weight-semibold);
      text-decoration: none;
      transition: all var(--transition-fast);
      backdrop-filter: var(--blur-sm);
      cursor: pointer;
      font-size: 0.9rem;
    }

    .nav-button:hover {
      background: var(--color-white-30);
      transform: translateY(-1px);
    }

    .donate-nav-btn {
      background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-secondary-dark) 100%);
      border: none;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .donate-nav-btn:hover {
      background: linear-gradient(135deg, var(--color-secondary-dark) 0%, var(--color-secondary-darker) 100%);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    /* Hero Section */
    .hero-title {
      font-size: clamp(var(--font-size-4xl), 6vw, var(--font-size-3xl));
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-lg);
      line-height: var(--line-height-tight);
      background: linear-gradient(135deg, var(--color-white) 0%, var(--color-blue-light) 50%, var(--color-blue-lighter) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 40px rgba(59, 130, 246, 0.3);
    }

    .hero-subtitle {
      font-size: clamp(var(--font-size-xl), 4vw, var(--font-size-2xl));
      margin-bottom: var(--space-2xl);
      color: rgba(224, 242, 254, 0.9);
      line-height: var(--line-height-normal);
      font-weight: var(--font-weight-normal);
    }

    .hero-input-container {
      max-width: 600px;
      margin: 0 auto var(--space-2xl);
      position: relative;
    }

    /* Input Styles */
    .hero-input, .chat-input {
      width: 100%;
      padding: var(--space-lg) var(--space-xl);
      font-size: var(--font-size-lg);
      border: 2px solid var(--color-blue-alpha-30);
      border-radius: var(--radius-xl);
      background: var(--color-primary-alpha-10);
      backdrop-filter: var(--blur-md);
      color: var(--color-white);
      outline: none;
      transition: all var(--transition-fast);
      resize: none;
      min-height: 60px;
      font-family: inherit;
      box-shadow: var(--shadow-md);
    }

    .hero-input::placeholder, .chat-input::placeholder {
      color: rgba(186, 230, 253, 0.7);
    }

    .hero-input:focus, .chat-input:focus {
      border-color: var(--color-blue-alpha-60);
      background: var(--color-primary-alpha-15);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .chat-input {
      background: transparent !important;
      border: none !important;
      padding: 0;
      font-size: var(--font-size-base);
      resize: none;
      min-height: 24px;
      max-height: 120px;
      line-height: var(--line-height-relaxed);
      box-shadow: none !important;
      transform: none;
      flex: 1;
      outline: none !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
      border-radius: 0;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }

    .chat-input:focus {
      background: transparent !important;
      border: none !important;
      transform: none !important;
      box-shadow: none !important;
      outline: none !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
    }

    .chat-input::placeholder {
      color: var(--color-white-50);
    }

    /* Buttons */
    .input-button, .send-button {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
      color: var(--color-white);
      border: none;
      border-radius: var(--radius-sm);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-sm);
    }

    .input-button {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      padding: 0.75rem var(--space-lg);
    }

    .input-button:hover {
      background: linear-gradient(135deg, var(--color-primary-dark) 0%, var(--color-primary-darker) 100%);
      transform: translateY(-50%) translateY(-1px);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
    }

    .send-button {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .send-button:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--color-primary-dark) 0%, var(--color-primary-darker) 100%);
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
    }

    .send-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .send-icon {
      width: 18px;
      height: 18px;
    }

    /* Example Cards */
    .examples-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-md);
      max-width: var(--chat-max);
      margin: 0 auto var(--space-2xl);
    }

    .example-card {
      background: var(--color-primary-alpha-15);
      backdrop-filter: var(--blur-md);
      border: 1px solid var(--color-blue-alpha-30);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: left;
      box-shadow: var(--shadow-md);
      opacity: 0;
    }

    .example-card:hover {
      background: var(--color-primary-alpha-25);
      border-color: var(--color-blue-alpha-50);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .example-card h3 {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      margin-bottom: var(--space-sm);
      color: var(--color-blue-light);
    }

    .example-card p {
      color: rgba(186, 230, 253, 0.9);
      font-size: 0.9rem;
      line-height: var(--line-height-normal);
    }

    /* Stats */
    .stats-section {
      display: flex;
      justify-content: center;
      gap: var(--space-2xl);
      margin: var(--space-xl) 0 var(--space-3xl) 0;
    }

    .stat {
      text-align: center;
      opacity: 0;
    }

    .stat-number {
      font-size: var(--font-size-3xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-white);
      display: block;
    }

    /* Chat Messages */

    /* Example Cards */
    .examples-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-md);
      max-width: var(--chat-max);
      margin: 0 auto var(--space-2xl);
    }

    .example-card {
      background: var(--color-primary-alpha-15);
      backdrop-filter: var(--blur-md);
      border: 1px solid var(--color-blue-alpha-30);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: left;
      box-shadow: var(--shadow-md);
      opacity: 1;
    }

    .example-card:hover {
      background: var(--color-primary-alpha-25);
      border-color: var(--color-blue-alpha-50);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .example-card h3 {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      margin-bottom: var(--space-sm);
      color: var(--color-blue-light);
    }

    .example-card p {
      color: rgba(186, 230, 253, 0.9);
      font-size: 0.9rem;
      line-height: var(--line-height-normal);
    }

    /* Stats */
    .stats-section {
      display: flex;
      justify-content: center;
      gap: var(--space-2xl);
      margin: var(--space-xl) 0 var(--space-3xl) 0;
    }

    .stat {
      text-align: center;
      opacity: 1;
    }

    .stat-number {
      font-size: var(--font-size-3xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-white);
      display: block;
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--color-white-70);
      margin-top: var(--space-xs);
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-md) 0;
      margin-bottom: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      min-height: 200px;
    }

    .message {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      animation: messageSlideIn 0.4s ease-out;
    }

    .message.user {
      align-items: flex-end;
    }

    .message.assistant {
      align-items: flex-start;
    }

    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: var(--color-primary-alpha-30);
      border: 2px solid var(--color-blue-alpha-40);
    }

    .message.assistant .message-avatar {
      background: var(--color-white-20);
      border: 2px solid var(--color-white-30);
    }

    .message-content {
      flex: 1;
      max-width: 80%;
    }

    .message-bubble {
      padding: var(--space-md) 1.25rem;
      border-radius: var(--radius-lg);
      backdrop-filter: var(--blur-md);
      font-size: 0.95rem;
      line-height: var(--line-height-relaxed);
      word-wrap: break-word;
    }

    .message.user .message-bubble {
      background: var(--color-primary-alpha-20);
      border: 1px solid var(--color-blue-alpha-30);
      color: var(--color-white);
    }

    .message.assistant .message-bubble {
      background: var(--color-white-15);
      border: 1px solid var(--color-white-20);
      color: rgba(255, 255, 255, 0.95);
    }

    .message-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--space-sm);
    }

    .message-footer .left-items {
      display: flex;
      align-items: center;
      gap: 0;
    }

    .message-time {
      font-size: var(--font-size-xs);
      color: var(--color-white-50);
    }

    .message.user .message-time {
      text-align: right;
    }

    .message.assistant .message-time {
      text-align: left;
    }

    .message-actions {
      display: flex;
      gap: var(--space-sm);
      opacity: 0.6;
      transition: opacity var(--transition-fast);
    }

    .message.assistant:hover .message-actions {
      opacity: 1;
    }

    .feedback-btn {
      background: none;
      border: none;
      color: var(--color-white-50);
      cursor: pointer;
      padding: var(--space-xs);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      width: 24px;
      height: 24px;
    }

    .feedback-btn:hover {
      background: var(--color-white-10);
      color: var(--color-white-80);
    }

    .feedback-btn.active {
      color: var(--color-white);
      background: var(--color-white-20);
    }

    .feedback-btn.like.active {
      color: #10B981;
    }

    .feedback-btn.dislike.active {
      color: #EF4444;
    }

    .share-btn {
      background: none;
      border: none;
      color: var(--color-white-50);
      cursor: pointer;
      padding: var(--space-xs);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      width: 24px;
      height: 24px;
      margin-right: var(--space-sm);
    }

    .share-btn:hover {
      background: var(--color-white-10);
      color: var(--color-white-80);
    }

    .share-icon {
      width: 14px;
      height: 14px;
    }

    .scripture-reference {
      font-style: italic;
      color: rgba(186, 230, 253, 0.9);
      margin-top: var(--space-sm);
      font-size: var(--font-size-sm);
    }

    /* Chat Input Container */
    .chat-input-container {
      position: sticky;
      bottom: 0;
      background: var(--color-white-05);
      backdrop-filter: var(--blur-md);
      border-radius: var(--radius-xl);
      padding: var(--space-md);
      border: 2px solid var(--color-blue-alpha-20);
      transition: all var(--transition-fast);
    }

    .chat-input-container.feedback-mode {
      border-color: var(--color-white);
      background: var(--color-white-05);
      box-shadow: 0 0 20px var(--color-white-30);
      animation: feedbackPulse 1.5s ease-in-out;
    }

    .chat-input-container.feedback-mode:focus-within {
      border-color: var(--color-white);
      background: var(--color-white-05);
    }

    .chat-input-row {
      display: flex;
      gap: var(--space-md);
      align-items: flex-end;
      width: 100%;
    }

    /* =========================
       TYPING INDICATOR ANIMATION
       ========================= */
    .typing-indicator {
      display: none;
      justify-content: center;
      align-items: center;
      width: 100%;
      padding: var(--space-xl) 0;
    }

    .typing-indicator.show {
      display: flex;
    }

    .typing-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-lg);
      text-align: center;
    }

    /* Cycling text with icons animation */
    .typing-text {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      color: var(--color-white-90);
      font-size: 1rem;
      font-weight: var(--font-weight-medium);
      opacity: 0;
      animation: cycleTextWithIcon 9s infinite;
      transform: translateY(10px);
    }

    .typing-text:nth-child(1) { animation-delay: 0s; }
    .typing-text:nth-child(2) { animation-delay: 3s; }
    .typing-text:nth-child(3) { animation-delay: 6s; }

    .typing-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Typing dots container */
    .typing-dots {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      background: var(--color-white-15);
      padding: var(--space-md) var(--space-xl);
      border-radius: var(--radius-xl);
      backdrop-filter: var(--blur-md);
      min-width: 80px;
    }

    /* Individual typing dots */
    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--color-white-80);
      animation: typingDot 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    /* Animation keyframes for typing indicator */
    @keyframes cycleTextWithIcon {
      0% { opacity: 0; transform: translateY(10px) scale(0.95); }
      11.11% { opacity: 1; transform: translateY(0) scale(1); }
      22.22% { opacity: 1; transform: translateY(0) scale(1); }
      33.33% { opacity: 0; transform: translateY(-10px) scale(0.95); }
      100% { opacity: 0; transform: translateY(10px) scale(0.95); }
    }

    @keyframes typingDot {
      0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
      40% { opacity: 1; transform: scale(1.2); }
    }

    /* Floating Elements */
    .floating-circle {
      position: absolute;
      border-radius: var(--radius-full);
      background: var(--color-blue-alpha);
      backdrop-filter: var(--blur-sm);
      animation: float 20s infinite linear;
      box-shadow: 0 0 40px rgba(59, 130, 246, 0.2);
    }

    .floating-circle:nth-child(1) {
      width: 80px;
      height: 80px;
      top: 20%;
      left: 10%;
      animation-delay: 0s;
    }

    .floating-circle:nth-child(2) {
      width: 120px;
      height: 120px;
      top: 60%;
      right: 15%;
      animation-delay: -7s;
    }

    .floating-circle:nth-child(3) {
      width: 60px;
      height: 60px;
      bottom: 30%;
      left: 20%;
      animation-delay: -14s;
    }

    /* Footer */
    .footer-text {
      font-size: 0.875rem;
      color: var(--color-white-70);
    }

    .footer-text a {
      color: var(--color-white-90);
      text-decoration: none;
    }

    /* Loading States */
    .loading {
      display: none;
      align-items: center;
      gap: 8px;
      color: var(--color-white-80);
      font-size: 0.9rem;
    }

    .loading.show {
      display: flex;
    }

    .loading-dots {
      display: flex;
      gap: 3px;
    }

    .loading-dot {
      width: 4px;
      height: 4px;
      border-radius: var(--radius-full);
      background: var(--color-white-60);
      animation: loadingDot 1.4s infinite ease-in-out;
    }

    .loading-dot:nth-child(2) { animation-delay: 0.2s; }
    .loading-dot:nth-child(3) { animation-delay: 0.4s; }

    /* =========================
       DONATION MODAL
       ========================= */
    .donation-modal {
      position: fixed;
      inset: 0;
      z-index: var(--z-modal);
    }

    .donation-modal-overlay {
      position: absolute;
      inset: 0;
      background: var(--color-black-80);
      backdrop-filter: var(--blur-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-xl);
    }

    .donation-modal-content {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.95) 0%, rgba(5, 150, 105, 0.95) 100%);
      border-radius: var(--radius-xl);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 2px solid rgba(167, 243, 208, 0.3);
      box-shadow: var(--shadow-xl);
    }

    .donation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-xl) var(--space-xl) var(--space-md) var(--space-xl);
      border-bottom: 1px solid var(--color-white-20);
    }

    .donation-header h2 {
      color: var(--color-white);
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-semibold);
      margin: 0;
    }

    .donation-close {
      background: none;
      border: none;
      color: var(--color-white);
      font-size: var(--font-size-3xl);
      cursor: pointer;
      padding: 0;
      line-height: 1;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .donation-close:hover {
      opacity: 1;
    }

    .donation-body {
      padding: var(--space-xl);
    }

    .donation-body > p {
      color: var(--color-white-90);
      font-size: var(--font-size-lg);
      margin-bottom: var(--space-xl);
      text-align: center;
      line-height: var(--line-height-relaxed);
    }

    .donation-amounts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .donation-amount {
      background: var(--color-white-10);
      border: 2px solid var(--color-white-20);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      text-align: center;
      transition: all var(--transition-normal);
      cursor: pointer;
    }

    .donation-amount:hover {
      border-color: var(--color-white-50);
      background: var(--color-white-15);
    }

    .donation-amount.selected {
      border-color: var(--color-white-80);
      background: var(--color-white-20);
    }

    .donation-amount .price {
      color: var(--color-white);
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-xs);
    }

    .donation-amount p {
      color: var(--color-white-80);
      font-size: 0.8rem;
      margin: 0;
    }

    .custom-amount {
      margin-bottom: var(--space-xl);
    }

    .custom-amount label {
      color: var(--color-white-90);
      font-size: 0.9rem;
      display: block;
      margin-bottom: var(--space-sm);
    }

    .custom-amount input {
      width: 100%;
      padding: 0.75rem var(--space-md);
      border: 2px solid var(--color-white-20);
      border-radius: var(--radius-sm);
      background: var(--color-white-10);
      color: var(--color-white);
      font-size: var(--font-size-base);
      outline: none;
      transition: all var(--transition-normal);
    }

    .custom-amount input::placeholder {
      color: var(--color-white-50);
    }

    .custom-amount input:focus {
      border-color: var(--color-white-50);
      background: var(--color-white-15);
    }

    .donation-buttons {
      display: flex;
      gap: var(--space-md);
      margin-bottom: var(--space-md);
    }

    .donation-btn {
      flex: 1;
      background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-secondary-dark) 100%);
      color: var(--color-white);
      border: none;
      border-radius: var(--radius-sm);
      padding: 0.75rem var(--space-lg);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .donation-btn:hover {
      background: linear-gradient(135deg, var(--color-secondary-dark) 0%, var(--color-secondary-darker) 100%);
      transform: translateY(-2px);
    }

    .skip-btn {
      flex: 1;
      background: var(--color-white-10);
      color: var(--color-white);
      border: 2px solid var(--color-white-30);
      border-radius: var(--radius-sm);
      padding: 0.75rem var(--space-lg);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .skip-btn:hover {
      background: var(--color-white-20);
      border-color: var(--color-white-50);
    }

    .donation-footer {
      text-align: center;
      padding-top: var(--space-md);
      border-top: 1px solid var(--color-white-20);
    }

    .donation-footer p {
      color: var(--color-white-70);
      font-size: var(--font-size-sm);
      margin: var(--space-xs) 0;
    }

    /* =========================
       UTILITIES / OTHER ANIMATIONS
       ========================= */
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
      50% { transform: translateY(-20px) rotate(180deg); opacity: 0.6; }
    }

    @keyframes messageSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes typingDot {
      0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
      40% { opacity: 1; transform: scale(1); }
    }

    @keyframes cycleText {
      0%, 20% { opacity: 1; }
      25%, 100% { opacity: 0; }
    }

    @keyframes feedbackPulse {
      0% { 
        box-shadow: 0 0 20px var(--color-white-30);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 0 30px var(--color-white-50);
        transform: scale(1.02);
      }
      100% { 
        box-shadow: 0 0 20px var(--color-white-30);
        transform: scale(1);
      }
    }

    /* =========================
       RESPONSIVE
       ========================= */
    @media (max-width: 768px) {
      .header {
        padding: var(--space-md);
      }

      .nav {
        flex-wrap: nowrap;
        align-items: center;
        justify-content: space-between;
      }

      .logo {
        font-size: 0;
        flex-shrink: 0;
      }

      .logo-icon {
        width: 32px;
        height: 32px;
      }

      .nav-links {
        gap: var(--space-sm);
        flex-wrap: nowrap;
      }

      .nav-button {
        width: 44px;
        height: 44px;
        min-width: 44px;
        padding: 0;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0;
      }

      .nav-text {
        display: none;
      }

      .nav-icon {
        display: block !important;
      }

      .donate-nav-btn .nav-icon {
        width: 20px;
        height: 20px;
      }

      .start-nav-btn .nav-icon {
        width: 20px;
        height: 20px;
      }

      .landing-page {
        padding: var(--space-md);
        padding-top: 100px;
      }

      .hero-input-container {
        margin-bottom: var(--space-xl);
      }

      .hero-input {
        padding: 1.25rem var(--space-lg);
        font-size: var(--font-size-base);
      }

      .input-button {
        position: static;
        transform: none;
        width: 100%;
        margin-top: var(--space-md);
        border-radius: var(--radius-sm);
      }

      .examples-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      .stats-section {
        gap: var(--space-xl);
        flex-wrap: wrap;
      }

      .chat-container {
        padding: var(--space-md);
      }

      .hero-title {
        font-size: var(--font-size-2xl);
      }

      .message-content {
        max-width: 95%;
      }

      .footer {
        position: relative;
        margin-top: var(--space-2xl);
      }

      .footer.hidden {
        transform: none;
        opacity: 1;
        display: none;
      }

      .donation-modal-content {
        margin: var(--space-md);
        max-height: 95vh;
      }

      .donation-header {
        padding: var(--space-lg) var(--space-lg) var(--space-md) var(--space-lg);
      }

      .donation-header h2 {
        font-size: 1.3rem;
      }

      .donation-body {
        padding: var(--space-lg);
      }

      .donation-amounts {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }

      .donation-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <!-- ======= BACKGROUND LAYERS ======= -->
  <div class="gradient-overlay"></div>
  <div class="floating-elements">
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
    <div class="floating-circle"></div>
  </div>

  <!-- ======= HEADER ======= -->
  <header class="header">
    <nav class="nav">
      <a href="#" class="logo" onclick="goHome()">
        <img class="logo-icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAwIDI5MzQuNjIiPgogIDxkZWZzPgogICAgPHN0eWxlPgogICAgICAuY2xzLTEgewogICAgICAgIGZpbGw6ICNmZmY7CiAgICAgIH0KICAgIDwvc3R5bGU+CiAgPC9kZWZzPgogIDxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTEyOTcuMzEsMTE4NC4wMWwtLjQ5LTIuMDVjLS4xNi42OC0uMzIsMS4zNy0uNDgsMi4wNS0yNy4xNCwxMTUuMjYtMTE1LjcsMjAzLjk1LTIzMC45MiwyMzEuMjRsLTIuNDYuNThjLjgxLjE5LDEuNjMuMzksMi40NC41OCwxMTUuMDksMjcuMjUsMjAzLjU5LDExNS43NSwyMzAuODUsMjMwLjg0bC41OCwyLjQ0Yy4xOS0uODEuMzktMS42Mi41OC0yLjQ0LDI3LjI4LTExNS4yMywxMTUuOTctMjAzLjgxLDIzMS4yNC0yMzAuOTVsMi4wNC0uNDhjLS42OC0uMTYtMS4zNy0uMzItMi4wNS0uNDktMTE1LjQtMjcuMTctMjA0LjE2LTExNS45Mi0yMzEuMzMtMjMxLjMzWiIvPgogIDxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTE4NDcuNzIsMTI5Ny45NmMtMTc2LTM0Mi44MS01NDUuMTgtODg0LjY4LTc0OS41Ny0xMTc3LjE4bC03Ni41MS0xMDkuNDljLTEwLjUxLTE1LjA0LTMyLjc5LTE1LjA0LTQzLjMsMGwtNzYuNTEsMTA5LjQ5QzY5Ny40NCw0MTMuMjQsMzI4LjMxLDk1NS4wOCwxNTIuMjMsMTI5OC4wMWMtMTYzLjUzLDMxOC45My0yMzIuMTIsODA3LjA1LTE2LjcyLDExNzguNjMsMTEzLjYsMTk1Ljk2LDQwNC40Myw0NjUuNjYsODU4Ljk0LDQ1Ny44MSwwLDAsNTk1LjM0LDE1LjkxLDg3MC4wNS00NTcuODEsMjE1LjQ0LTM3MS41MiwxNDYuNzktODU5LjY5LTE2Ljc2LTExNzguNjhaTTE2NTcuMjYsMjM1Ni41MWMtNTcuMzcsOTguOTctMTM3LjUxLDE3Ni4zMy0yMzkuMjIsMjMyLjMsMTIuNjEtODAuNDMsMjYuNDEtMjQ2LjM4LTY2LjUxLTM1OS4yNi0xMjYuMzItMTUzLjQ2LTM3MS42NS0xNzguMzgtNDYxLjg4LTI2MS4yMy04Ni40Ni03OS4zOS00Ni41OC0xNTYuMDIsMjIwLjQzLTI1MC45MSwxOS45OC03LjEsMzAuNTgtMjkuMDUsMjMuNzctNDkuMTMtNS45Mi0xNy40Ni0yMy4yMi0yOC40NC00MS41MS0yNi4xNC04Ny43LDExLjA0LTMzNC43Niw1My44Ny00MzMuNjUsMTkzLjQ4LTEyMS4yMywxNzEuMTQsMTA4LjM2LDM0NS41OSwyODQuNjgsNDExLjAyLDE3Ni4zMiw2NS40MiwyNjYuMTksMTY5LjUyLDIwOC45MSwyOTMuNDYtNTAuNzcsMTA5Ljg3LTI3My4yLDE0My42Mi00NjcuNjUsOTUuNTItMTUxLjkzLTU1LjU5LTI2Ni40MS0xNDguODctMzQxLjkyLTI3OS4xMS0xNjkuMTgtMjkxLjg3LTEwNi44Ni02OTYuNjMsMjIuNjEtOTQ5LjE1LDE0NC42MS0yODEuNjQsNDI5LjM1LTcwOS42NCw2MzQuNjYtMTAwNy44NiwyMDUuMzIsMjk4LjI1LDQ5MC4wOSw3MjYuMjcsNjM0LjYyLDEwMDcuNzgsMTI5LjUxLDI1Mi42LDE5MS44Myw2NTcuMzYsMjIuNjUsOTQ5LjIzWiIvPgo8L3N2Zz4=" alt="PocketPilgrim" />
        PocketPilgrim
      </a>
      
      <div class="nav-links">
        <button class="nav-button donate-nav-btn" onclick="showDonationModal()">
          <span class="nav-text">💚 Support Us</span>
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
          </svg>
        </button>
        <button class="nav-button start-nav-btn" onclick="startChat()" id="startChatBtn">
          <span class="nav-text">Start guidance</span>
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </button>
        <button class="nav-button start-nav-btn" onclick="newChat()" id="newChatBtn" style="display: none;">
          <span class="nav-text">New chat</span>
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </button>
      </div>
    </nav>
  </header>

  <!-- ======= LANDING PAGE ======= -->
  <main class="landing-page" id="landingPage">
    <div class="hero-content">
      <h1 class="hero-title">Find peace through Scripture</h1>
      <p class="hero-subtitle">Get compassionate, Bible-grounded guidance by simply sharing what's on your heart - completely free</p>
      
      <div class="hero-input-container">
        <textarea 
          id="heroInput" 
          class="hero-input" 
          placeholder="Share what's weighing on your heart..."
          rows="1"
        ></textarea>
        <button class="input-button" onclick="handleLandingSubmit()">
          <span id="buttonText">Get guidance</span>
          <div class="loading" id="loading">
            <div class="loading-dots">
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
            </div>
            Finding guidance...
          </div>
        </button>
      </div>

      <div class="examples-grid">
        <div class="example-card" onclick="useExample('I\'m feeling overwhelmed by work stress and deadlines')">
          <h3>💼 Work & Stress</h3>
          <p>"I'm feeling overwhelmed by work stress and deadlines"</p>
        </div>
        
        <div class="example-card" onclick="useExample('I\'m struggling to forgive someone who deeply hurt me')">
          <h3>💔 Forgiveness</h3>
          <p>"I'm struggling to forgive someone who deeply hurt me"</p>
        </div>
        
        <div class="example-card" onclick="useExample('I feel lost and don\'t know God\'s plan for my life')">
          <h3>🗺️ Purpose</h3>
          <p>"I feel lost and don't know God's plan for my life"</p>
        </div>
        
        <div class="example-card" onclick="useExample('I\'m grieving the loss of someone very close to me')">
          <h3>🕊️ Grief</h3>
          <p>"I'm grieving the loss of someone very close to me"</p>
        </div>
      </div>

      <div class="stats-section">
        <div class="stat">
          <span class="stat-number">10K+</span>
          <span class="stat-label">Conversations</span>
        </div>
        <div class="stat">
          <span class="stat-number">500+</span>
          <span class="stat-label">Bible Verses</span>
        </div>
        <div class="stat">
          <span class="stat-number">100%</span>
          <span class="stat-label">Free</span>
        </div>
      </div>
    </div>
  </main>

  <!-- ======= CHAT INTERFACE ======= -->
  <div class="chat-interface" id="chatInterface">
    <div class="chat-container">
      <div class="chat-messages" id="chatMessages">
      </div>

      <div class="typing-indicator" id="typingIndicator">
        <div class="typing-container">
          <div class="typing-text">
            <svg class="typing-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span>empathizing...</span>
          </div>
          <div class="typing-text">
            <svg class="typing-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"></path>
              <path d="M21 12c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
              <path d="M3 12c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
              <path d="M12 21c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
              <path d="M12 3c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
              <circle cx="12" cy="12" r="7"></circle>
            </svg>
            <span>understanding...</span>
          </div>
          <div class="typing-text">
            <svg class="typing-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
            </svg>
            <span>responding...</span>
          </div>
          <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      </div>

      <div class="chat-input-container">
        <div class="chat-input-row">
          <textarea 
            id="chatInput" 
            class="chat-input" 
            placeholder="Share what's on your heart..."
            rows="1"
          ></textarea>
          <button class="send-button" id="sendButton" onclick="sendMessage()">
            <svg class="send-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ======= FOOTER ======= -->
  <footer class="footer" id="footer">
    <p class="footer-text">
      AI-assisted spiritual guidance grounded in Scripture - Always free. 
      Not medical, legal, or mental health advice. 
      Crisis support: <a href="tel:988">Call 988</a>
    </p>
  </footer>

  <script>
    // =========================
    // UTILITIES / HELPERS
    // =========================
    const DOM = {
      landingPage: document.getElementById('landingPage'),
      chatInterface: document.getElementById('chatInterface'),
      footer: document.getElementById('footer'),
      heroInput: document.getElementById('heroInput'),
      chatInput: document.getElementById('chatInput'),
      chatMessages: document.getElementById('chatMessages'),
      sendButton: document.getElementById('sendButton'),
      typingIndicator: document.getElementById('typingIndicator'),
      startChatBtn: document.getElementById('startChatBtn'),
      newChatBtn: document.getElementById('newChatBtn'),
      buttonText: document.getElementById('buttonText'),
      loading: document.getElementById('loading')
    };

    const CONFIG = {
      WEBHOOK_URL: 'https://alertahora.app.n8n.cloud/webhook/spiritual-advice',
      DONATION_URL: 'https://your-donation-provider.com/donate'
    };

    const SCRIPTURE_VERSES = [
      '"Cast all your anxiety on him because he cares for you." - 1 Peter 5:7',
      '"Be still, and know that I am God." - Psalm 46:10',
      '"And we know that in all things God works for the good of those who love him." - Romans 8:28',
      '"Trust in the Lord with all your heart and lean not on your own understanding." - Proverbs 3:5',
      '"Peace I leave with you; my peace I give you." - John 14:27',
      '"The Lord is my shepherd, I lack nothing." - Psalm 23:1',
      '"Come to me, all you who are weary and burdened, and I will give you rest." - Matthew 11:28'
    ];

    function generateSessionId() {
      return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function generateScriptureReference() {
      return SCRIPTURE_VERSES[Math.floor(Math.random() * SCRIPTURE_VERSES.length)];
    }

    function setupTextarea(textarea) {
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        if (textarea === DOM.chatInput) updateSendButton();
      });

      textarea.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          if (textarea === DOM.heroInput) {
            handleLandingSubmit();
          } else {
            sendMessage();
          }
        }
      });
    }

    function updateSendButton() {
      const hasText = DOM.chatInput.value.trim().length > 0;
      DOM.sendButton.disabled = !hasText;
    }

    // =========================
    // STATE MANAGEMENT
    // =========================
    const AppState = {
      conversationStarted: false,
      isInChatMode: false,
      messageCount: 0,
      selectedDonationAmount: 0,
      waitingForFeedback: false
    };

    // =========================
    // UI TRANSITIONS
    // =========================
    function transitionToChat(initialMessage = '') {
      AppState.isInChatMode = true;
      
      DOM.footer.classList.add('hidden');
      DOM.landingPage.classList.add('hidden');
      
      DOM.startChatBtn.style.display = 'none';
      DOM.newChatBtn.style.display = 'block';
      
      setTimeout(() => {
        DOM.landingPage.style.display = 'none';
        DOM.chatInterface.classList.add('active');
        
        if (initialMessage) {
          DOM.chatInput.value = initialMessage;
          updateSendButton();
          setTimeout(() => {
            sendMessage();
          }, 300);
        }
        
        DOM.chatInput.focus();
      }, 400);
    }

    function goHome() {
      try {
        if (AppState.isInChatMode) {
          AppState.isInChatMode = false;
          AppState.conversationStarted = false;
          AppState.messageCount = 0;
          
          DOM.chatInterface.classList.remove('active');
          DOM.chatMessages.innerHTML = '';
          
          DOM.heroInput.value = '';
          DOM.chatInput.value = '';
          DOM.heroInput.style.height = 'auto';
          DOM.chatInput.style.height = 'auto';
          
          if (DOM.buttonText) DOM.buttonText.style.display = 'inline';
          if (DOM.loading) DOM.loading.classList.remove('show');
          
          setTimeout(() => {
            DOM.landingPage.style.display = 'flex';
            DOM.landingPage.classList.remove('hidden');
            DOM.footer.classList.remove('hidden');
            
            DOM.startChatBtn.style.display = 'block';
            DOM.newChatBtn.style.display = 'none';
          }, 100);
        }
      } catch (error) {
        console.warn('Error during navigation:', error);
        window.location.reload();
      }
    }

    // =========================
    // CHAT FUNCTIONALITY
    // =========================
    function handleLandingSubmit() {
      const message = DOM.heroInput.value.trim();
      if (!message) {
        DOM.heroInput.focus();
        return;
      }

      DOM.buttonText.style.display = 'none';
      DOM.loading.classList.add('show');

      setTimeout(() => {
        transitionToChat(message);
      }, 800);
    }

    function startChat() {
      transitionToChat();
    }

    function newChat() {
      DOM.chatMessages.innerHTML = '';
      DOM.chatInput.value = '';
      DOM.chatInput.style.height = 'auto';
      updateSendButton();
      AppState.conversationStarted = false;
      AppState.messageCount = 0;
      
      DOM.chatInput.focus();
    }

    function useExample(exampleText) {
      DOM.heroInput.value = exampleText;
      DOM.heroInput.style.height = 'auto';
      DOM.heroInput.style.height = Math.min(DOM.heroInput.scrollHeight, 120) + 'px';
      
      setTimeout(() => {
        handleLandingSubmit();
      }, 300);
    }

    function addMessage(content, isUser = false, includeScripture = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
      
      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';
      messageContent.style.maxWidth = '100%'; // Full width since no avatar
      
      const messageBubble = document.createElement('div');
      messageBubble.className = 'message-bubble';
      messageBubble.innerHTML = content;
      
      if (includeScripture) {
        const scripture = document.createElement('div');
        scripture.className = 'scripture-reference';
        scripture.innerHTML = generateScriptureReference();
        messageBubble.appendChild(scripture);
      }
      
      const messageFooter = document.createElement('div');
      messageFooter.className = 'message-footer';
      
      const messageTime = document.createElement('div');
      messageTime.className = 'message-time';
      messageTime.textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      // Add share button for assistant messages
      if (!isUser) {
        const leftItems = document.createElement('div');
        leftItems.className = 'left-items';
        
        const shareBtn = document.createElement('button');
        shareBtn.className = 'share-btn';
        shareBtn.onclick = () => handleShare(messageDiv);
        shareBtn.innerHTML = `
          <svg class="share-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
        `;
        
        leftItems.appendChild(shareBtn);
        leftItems.appendChild(messageTime);
        messageFooter.appendChild(leftItems);
      } else {
        messageFooter.appendChild(messageTime);
      }
      
      // Add feedback buttons only for assistant messages
      if (!isUser) {
        const messageActions = document.createElement('div');
        messageActions.className = 'message-actions';
        
        const likeBtn = document.createElement('button');
        likeBtn.className = 'feedback-btn like';
        likeBtn.onclick = () => {
          console.log('Like button clicked!');
          handleFeedback(messageDiv, 'like');
        };
        likeBtn.innerHTML = `
          <svg class="feedback-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
          </svg>
        `;
        
        const dislikeBtn = document.createElement('button');
        dislikeBtn.className = 'feedback-btn dislike';
        dislikeBtn.onclick = () => {
          console.log('Dislike button clicked!');
          handleFeedback(messageDiv, 'dislike');
        };
        dislikeBtn.innerHTML = `
          <svg class="feedback-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
          </svg>
        `;
        
        messageActions.appendChild(likeBtn);
        messageActions.appendChild(dislikeBtn);
        messageFooter.appendChild(messageActions);
      }
      
      messageContent.appendChild(messageBubble);
      messageContent.appendChild(messageFooter);
      
      messageDiv.appendChild(messageContent);
      
      return messageDiv;
    }

    async function sendMessage() {
      const message = DOM.chatInput.value.trim();
      if (!message || DOM.sendButton.disabled) return;

      console.log('Sending message, waitingForFeedback:', AppState.waitingForFeedback);

      const userMessage = addMessage(message, true);
      DOM.chatMessages.appendChild(userMessage);

      DOM.chatInput.value = '';
      DOM.chatInput.style.height = 'auto';
      updateSendButton();

      // Check if this was feedback and handle accordingly
      if (AppState.waitingForFeedback) {
        console.log('Processing as feedback');
        // Send thank you message and reset feedback mode
        setTimeout(() => {
          sendThankYouMessage();
          resetFeedbackMode();
          console.log('Feedback mode reset');
        }, 1000);
        return; // Don't process as regular message
      }

      // Check for donation prompt when user sends a message
      console.log('About to call maybeShowDonationPrompt');
      maybeShowDonationPrompt();

      DOM.typingIndicator.classList.add('show');
      DOM.chatMessages.scrollTop = DOM.chatMessages.scrollHeight;

      // Optional tiny delay to prevent flash on ultra-fast replies
      await new Promise(resolve => setTimeout(resolve, 400));

      let response;
      try {
        response = await callWebhook(message);
      } finally {
        // Hide indicator only AFTER webhook completes (success or error)
        DOM.typingIndicator.classList.remove('show');
      }

      const assistantMessage = addMessage(response, false, true);
      DOM.chatMessages.appendChild(assistantMessage);
      DOM.chatMessages.scrollTop = DOM.chatMessages.scrollHeight;
    }

    // =========================
    // SHARE FUNCTIONALITY
    // =========================
    function handleShare(messageElement) {
      const messageText = messageElement.querySelector('.message-bubble').textContent;
      const scripture = messageElement.querySelector('.scripture-reference');
      const scriptureText = scripture ? scripture.textContent : '';
      
      const shareText = `${messageText}\n\n${scriptureText}\n\nShared from PocketPilgrim - Find peace through Scripture`;
      
      if (navigator.share) {
        // Use native sharing if available (mobile devices)
        navigator.share({
          title: 'Spiritual Guidance from PocketPilgrim',
          text: shareText,
          url: window.location.href
        }).catch(console.log);
      } else {
        // Fallback to clipboard
        navigator.clipboard.writeText(shareText).then(() => {
          // Show temporary feedback
          const shareBtn = messageElement.querySelector('.share-btn');
          const originalContent = shareBtn.innerHTML;
          shareBtn.innerHTML = `
            <svg class="share-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
          `;
          shareBtn.style.color = '#10B981';
          
          setTimeout(() => {
            shareBtn.innerHTML = originalContent;
            shareBtn.style.color = '';
          }, 2000);
        }).catch(() => {
          console.log('Share failed, but text was: ', shareText);
        });
      }
    }

    // =========================
    // FEEDBACK SYSTEM
    // =========================
    function handleFeedback(messageElement, type) {
      const messageActions = messageElement.querySelector('.message-actions');
      const likeBtn = messageActions.querySelector('.like');
      const dislikeBtn = messageActions.querySelector('.dislike');
      const chatInputContainer = document.querySelector('.chat-input-container');
      
      // Reset both buttons
      likeBtn.classList.remove('active');
      dislikeBtn.classList.remove('active');
      
      // Activate the clicked button
      if (type === 'like') {
        likeBtn.classList.add('active');
        // Reset chat input placeholder and styling if it was changed
        DOM.chatInput.placeholder = "Share what's on your heart...";
        chatInputContainer.classList.remove('feedback-mode');
      } else {
        dislikeBtn.classList.add('active');
        // Change chat input placeholder for feedback and highlight
        DOM.chatInput.placeholder = "How could we have improved our response?";
        chatInputContainer.classList.add('feedback-mode');
        DOM.chatInput.focus();
      }
      
      // Optional: Send feedback to analytics/webhook
      try {
        // You can add analytics tracking here
        console.log(`User ${type}d message:`, messageElement.querySelector('.message-bubble').textContent.substring(0, 50) + '...');
        
        // Optional: Send to webhook for feedback tracking
        // fetch('/api/feedback', {
        //   method: 'POST',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify({
        //     type: type,
        //     message: messageElement.querySelector('.message-bubble').textContent,
        //     timestamp: new Date().toISOString()
        //   })
        // });
      } catch (error) {
        console.log('Feedback recorded locally');
      }
    }

    // =========================
    // API COMMUNICATION
    // =========================
    async function callWebhook(userMessage) {
      try {
        const response = await fetch(CONFIG.WEBHOOK_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: userMessage,
            timestamp: new Date().toISOString(),
            sessionId: generateSessionId()
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        
        if (data.answerHtml) {
          return data.answerHtml;
        } else if (data.response) {
          return data.response;
        } else if (data.message) {
          return data.message;
        } else {
          console.log('Unexpected response format:', data);
          throw new Error('Invalid response format');
        }
      } catch (error) {
        console.error('Webhook error:', error);
        return generateFallbackResponse(userMessage);
      }
    }

    function generateFallbackResponse(userMessage) {
      const responses = {
        anxiety: "I hear the weight of anxiety in your words, and I want you to know that God sees your struggles and cares deeply for you. Anxiety can feel overwhelming, but remember that you are not meant to carry these burdens alone. The Lord invites us to cast all our anxieties on Him because He cares for us. This isn't just a nice sentiment—it's a powerful truth that can transform how we face our fears. Take time to breathe deeply and remember that God's love for you is unchanging, even in uncertain times.",
        
        forgiveness: "Forgiveness is one of the most challenging yet transformative acts we can embrace as followers of Christ. The pain you're feeling is valid, and God doesn't minimize the hurt you've experienced. Yet He calls us to forgive not because the offense was acceptable, but because forgiveness frees our own hearts from the prison of resentment. This doesn't mean trusting immediately or pretending the hurt didn't happen. Forgiveness is a process, often requiring us to choose it repeatedly. Ask God to help you take the first step, even if it's simply being willing to be willing to forgive.",
        
        purpose: "Feeling lost about God's plan for your life is more common than you might think, and it doesn't mean you're spiritually weak or lacking in faith. Sometimes God's plan unfolds slowly, like a path revealed one step at a time rather than showing us the entire journey at once. Trust that God is working in your life even when you can't see it clearly. Focus on being faithful in the small things before you, loving others well, and staying close to God through prayer and His Word. His plans for you are good, and He will guide your steps as you seek Him.",
        
        grief: "I'm so sorry for your loss. Grief is one of the deepest expressions of love—it shows how precious that person was to you. God doesn't ask you to rush through grief or pretend you're okay when you're not. He walks with you through this valley, and He understands sorrow intimately. It's okay to cry, to feel angry, or to struggle with questions. Take time to grieve, lean on your community, and remember that love never truly ends. The separation is temporary, but the love and memories you carry will always be part of you.",
        
        work: "Work stress can consume so much of our mental and emotional energy, leaving us feeling overwhelmed and depleted. God sees the pressure you're under and cares about every aspect of your life, including your work. Remember that your worth isn't defined by your productivity or success—you are beloved by God regardless of your performance. Try to set healthy boundaries where possible, take breaks to breathe and pray, and remember that most deadlines aren't as urgent as they feel in the moment. Trust God with the outcomes and do your best with peace in your heart.",
        
        default: "Thank you for sharing what's on your heart with me. I can sense that you're seeking God's guidance and comfort, and that takes courage. God sees exactly where you are right now—every struggle, every hope, every question you're carrying. He loves you deeply and wants to walk through this with you. Take time to be still in His presence, knowing that you are heard, you are seen, and you are loved. Whatever you're facing, you don't have to face it alone."
      };

      const message = userMessage.toLowerCase();
      
      if (message.includes('anxious') || message.includes('worry') || message.includes('stress') || message.includes('overwhelm')) {
        return responses.anxiety;
      } else if (message.includes('forgiv') || message.includes('hurt') || message.includes('angry')) {
        return responses.forgiveness;
      } else if (message.includes('purpose') || message.includes('lost') || message.includes('direction') || message.includes('plan')) {
        return responses.purpose;
      } else if (message.includes('grief') || message.includes('death') || message.includes('died') || message.includes('loss')) {
        return responses.grief;
      } else if (message.includes('work') || message.includes('job') || message.includes('deadline') || message.includes('career')) {
        return responses.work;
      } else {
        return responses.default;
      }
    }

    // =========================
    // DONATION SYSTEM
    // =========================
    function showDonationModal() {
      const modal = document.createElement('div');
      modal.className = 'donation-modal';
      modal.innerHTML = `
        <div class="donation-modal-overlay">
          <div class="donation-modal-content">
            <div class="donation-header">
              <h2>💚 Support PocketPilgrim</h2>
              <button class="donation-close" onclick="closeDonationModal()">&times;</button>
            </div>
            <div class="donation-body">
              <p>Your support helps us provide free spiritual guidance to everyone. Every donation, no matter the size, makes a difference in someone's life.</p>
              
              <div class="donation-amounts">
                <div class="donation-amount" onclick="selectAmount(5)">
                  <div class="price">$5</div>
                  <p>Coffee ☕</p>
                </div>
                <div class="donation-amount" onclick="selectAmount(15)">
                  <div class="price">$15</div>
                  <p>Lunch 🍽️</p>
                </div>
                <div class="donation-amount" onclick="selectAmount(25)">
                  <div class="price">$25</div>
                  <p>Support 💪</p>
                </div>
                <div class="donation-amount" onclick="selectAmount(50)">
                  <div class="price">$50</div>
                  <p>Generous ✨</p>
                </div>
              </div>
              
              <div class="custom-amount">
                <label for="customAmountInput">Or enter your own amount:</label>
                <input type="number" id="customAmountInput" placeholder="Enter amount" min="1" max="10000">
              </div>
              
              <div class="donation-buttons">
                <button class="donation-btn" onclick="proceedToDonation()">Donate Now</button>
                <button class="skip-btn" onclick="closeDonationModal()">Continue Free</button>
              </div>
              
              <div class="donation-footer">
                <p>🙏 Your generosity keeps this service free for everyone</p>
                <p>🔒 Secure payment processing • Tax-deductible receipt</p>
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function closeDonationModal() {
      const modal = document.querySelector('.donation-modal');
      if (modal) modal.remove();
    }

    function selectAmount(amount) {
      AppState.selectedDonationAmount = amount;
      const customInput = document.getElementById('customAmountInput');
      if (customInput) customInput.value = '';
      
      const amounts = document.querySelectorAll('.donation-amount');
      amounts.forEach(el => el.classList.remove('selected'));
      
      event.target.closest('.donation-amount').classList.add('selected');
    }

    function proceedToDonation() {
      const customInput = document.getElementById('customAmountInput');
      const customAmount = customInput ? parseFloat(customInput.value) : 0;
      
      const finalAmount = customAmount > 0 ? customAmount : AppState.selectedDonationAmount;
      
      if (finalAmount <= 0) {
        alert('Please select or enter a donation amount.');
        return;
      }
      
      const donationUrls = {
        stripe: `${CONFIG.DONATION_URL}?amount=${finalAmount * 100}`,
        paypal: `${CONFIG.DONATION_URL}?amount=${finalAmount}`,
        default: `${CONFIG.DONATION_URL}?amount=${finalAmount}`
      };
      
      window.open(donationUrls.default, '_blank');
      closeDonationModal();
      
      setTimeout(() => {
        alert('Thank you for your generous heart! Your support helps keep QuietGuide free for everyone. 🙏');
      }, 1000);
    }

    function maybeShowDonationPrompt() {
      AppState.messageCount++;
      
      if (AppState.messageCount === 5 || (AppState.messageCount > 5 && AppState.messageCount % 10 === 0)) {
        setTimeout(() => {
          if (Math.random() < 0.3) {
            showDonationModal();
          }
        }, 2000);
      }
    }

    // =========================
    // INTERACTIVE EFFECTS
    // =========================
    function setupInteractiveElements() {
      document.addEventListener('mousemove', function(e) {
        const circles = document.querySelectorAll('.floating-circle');
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;

        circles.forEach((circle, index) => {
          const speed = (index + 1) * 0.02;
          const xOffset = (x - 0.5) * 20 * speed;
          const yOffset = (y - 0.5) * 20 * speed;
          
          circle.style.transform += ` translate(${xOffset}px, ${yOffset}px)`;
        });
      });

      // Scroll reveal animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.animation = 'fadeInUp 0.6s ease forwards';
          }
        });
      }, observerOptions);

      document.querySelectorAll('.example-card, .stat').forEach(el => {
        observer.observe(el);
      });
    }

    // =========================
    // APP INIT
    // =========================
    function init() {
      try {
        setupTextarea(DOM.heroInput);
        setupTextarea(DOM.chatInput);
        updateSendButton();
        setupInteractiveElements();
      } catch (error) {
        console.warn('Initialization error:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
